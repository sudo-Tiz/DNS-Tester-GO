# Prometheus configuration example for DNS Tester Go
# This file shows how to configure Prometheus to scrape metrics from the API and workers
global:
  scrape_interval: 15s # Default scrape interval
  evaluation_interval: 15s # Evaluate rules every 15s
# Scrape configurations
scrape_configs:
  # API server metrics
  # - HTTP server stats, rate limiting
  # - DNS lookup metrics (collected when clients poll results)
  # - Coherence metrics (requests vs polls)
  - job_name: 'dnstester-api'
    static_configs:
      - targets: ['localhost:5000']
    metrics_path: '/metrics'
    scrape_interval: 10s
    scrape_timeout: 5s
    # Worker metrics (OPTIONAL - only if --enable-metrics flag is used)
    # By default, workers don't expose HTTP endpoints to avoid port conflicts
    # API collects metrics when clients poll results instead
    # Uncomment if you enable worker metrics:
    # - job_name: 'dnstester-workers'
    #   static_configs:
    #     - targets: ['localhost:9091']
    #   metrics_path: '/metrics'
    #   scrape_interval: 10s
    #   scrape_timeout: 5s

# Metrics exposed:
# - dns_api_requests_total: Number of DNS lookup requests submitted
# - dns_api_result_polls_total: Number of times clients polled results
# - dns_lookup_total: DNS queries by server, type, and result
# - dns_lookup_duration_seconds: DNS query duration histogram
# - dns_lookup_errors_total: DNS errors by server and type
#
# Coherence check: dns_api_requests_total should ~equal dns_api_result_polls_total
# If polls << requests: clients not retrieving results
# If polls >> requests: clients polling same result multiple times

# Alerting configuration (optional)
# alerting:
#   alertmanagers:
#     - static_configs:
#         - targets: ['localhost:9093']

# Rule files (optional)
# rule_files:
#   - "alerts.yml"
